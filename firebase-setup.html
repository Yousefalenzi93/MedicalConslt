<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إعداد Firebase - طريقتي العلاجي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                    <span class="text-white font-bold text-xl">🔥</span>
                </div>
                <h1 class="mr-3 text-xl font-bold text-gray-800">إعداد Firebase - طريقتي العلاجي</h1>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="min-h-screen bg-gray-50 py-8">
        <div class="max-w-4xl mx-auto px-4">
            <div class="bg-white rounded-lg shadow p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">🔥 إعداد Firebase لمنصة طريقتي العلاجي</h2>
                
                <!-- Firebase Config Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">1. إعدادات Firebase</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-600 mb-4">انسخ إعدادات Firebase من لوحة التحكم وضعها في الملف التالي:</p>
                        <code class="block bg-gray-800 text-green-400 p-4 rounded text-sm">
src/firebase/config.js
                        </code>
                        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded">
                            <p class="text-yellow-800 text-sm">⚠️ تأكد من استبدال القيم التالية بقيمك الحقيقية:</p>
                            <ul class="list-disc list-inside text-yellow-700 text-sm mt-2">
                                <li>apiKey</li>
                                <li>authDomain</li>
                                <li>projectId</li>
                                <li>storageBucket</li>
                                <li>messagingSenderId</li>
                                <li>appId</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Database Structure -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">2. هيكل قاعدة البيانات</h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-medium text-blue-900 mb-2">👥 مجموعة الأطباء (doctors)</h4>
                            <pre class="text-sm text-blue-800 bg-blue-100 p-3 rounded overflow-x-auto">
{
  "name": "د. أحمد محمد",
  "email": "ahmed@example.com",
  "phone": "+966501234567",
  "specialty": "طب القلب",
  "license": "DOC001",
  "hospital": "مستشفى الملك فيصل",
  "experience": "10 سنوات",
  "bio": "طبيب متخصص...",
  "status": "active",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
                            </pre>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-medium text-green-900 mb-2">📋 مجموعة طلبات الانضمام (joinRequests)</h4>
                            <pre class="text-sm text-green-800 bg-green-100 p-3 rounded overflow-x-auto">
{
  "name": "د. سارة أحمد",
  "email": "sara@example.com",
  "phone": "+966507654321",
  "specialty": "طب الجلدية",
  "license": "DOC006",
  "hospital": "مستشفى الملك خالد",
  "experience": "5 سنوات",
  "bio": "طبيبة متخصصة...",
  "status": "pending",
  "adminNotes": "",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
                            </pre>
                        </div>

                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-medium text-purple-900 mb-2">💬 مجموعة الاستشارات (consultations)</h4>
                            <pre class="text-sm text-purple-800 bg-purple-100 p-3 rounded overflow-x-auto">
{
  "doctorId": "doctor_document_id",
  "patientName": "مريض #1234",
  "specialty": "طب القلب",
  "status": "pending", // pending, in-progress, completed
  "description": "وصف الحالة...",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
                            </pre>
                        </div>
                    </div>
                </div>

                <!-- Installation Steps -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">3. خطوات التثبيت</h3>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">1</span>
                            <div class="mr-4">
                                <h4 class="font-medium text-gray-900">تثبيت Firebase</h4>
                                <code class="block bg-gray-800 text-green-400 p-2 rounded text-sm mt-2">npm install firebase</code>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">2</span>
                            <div class="mr-4">
                                <h4 class="font-medium text-gray-900">إنشاء مشروع Firebase</h4>
                                <p class="text-gray-600 text-sm mt-1">اذهب إلى Firebase Console وأنشئ مشروع جديد</p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">3</span>
                            <div class="mr-4">
                                <h4 class="font-medium text-gray-900">إعداد Firestore</h4>
                                <p class="text-gray-600 text-sm mt-1">فعّل Firestore Database في وضع الاختبار</p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">4</span>
                            <div class="mr-4">
                                <h4 class="font-medium text-gray-900">إعداد Authentication</h4>
                                <p class="text-gray-600 text-sm mt-1">فعّل Email/Password authentication</p>
                            </div>
                        </div>

                        <div class="flex items-start">
                            <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">5</span>
                            <div class="mr-4">
                                <h4 class="font-medium text-gray-900">تحديث الإعدادات</h4>
                                <p class="text-gray-600 text-sm mt-1">انسخ إعدادات Firebase إلى src/firebase/config.js</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">4. اختبار الاتصال</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button id="testFirebase" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                🔥 اختبار اتصال Firebase
                            </button>
                            <button id="addSampleData" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                📊 إضافة بيانات تجريبية
                            </button>
                        </div>
                        <div id="testResult" class="mt-4 hidden"></div>
                    </div>

                    <!-- Current Firebase Config -->
                    <div class="mt-4 bg-green-50 p-4 rounded-lg">
                        <h4 class="font-medium text-green-900 mb-2">✅ إعدادات Firebase الحالية</h4>
                        <div class="text-sm text-green-800 space-y-1">
                            <p><strong>Project ID:</strong> mtmconsult-f48f1</p>
                            <p><strong>Auth Domain:</strong> mtmconsult-f48f1.firebaseapp.com</p>
                            <p><strong>Storage:</strong> mtmconsult-f48f1.firebasestorage.app</p>
                            <p><strong>Analytics:</strong> مفعل (G-TR97F5BZ7L)</p>
                        </div>
                    </div>
                </div>

                <!-- Security Rules -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">5. قواعد الأمان</h3>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h4 class="font-medium text-red-900 mb-2">⚠️ قواعد Firestore الأمنية</h4>
                        <pre class="text-sm text-red-800 bg-red-100 p-3 rounded overflow-x-auto">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read/write access to authenticated users only
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Specific rules for doctors collection
    match /doctors/{doctorId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
                      request.auth.uid == doctorId;
    }
    
    // Admin-only access for join requests
    match /joinRequests/{requestId} {
      allow read, write: if request.auth != null && 
                            request.auth.token.admin == true;
    }
  }
}
                        </pre>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-lg font-medium text-green-900 mb-4">✅ الخطوات التالية</h3>
                    <ul class="list-disc list-inside text-green-800 space-y-2">
                        <li>تحديث إعدادات Firebase في config.js</li>
                        <li>تشغيل npm install لتثبيت Firebase</li>
                        <li>اختبار تسجيل الدخول والتسجيل</li>
                        <li>إضافة بيانات تجريبية للاختبار</li>
                        <li>تحديث قواعد الأمان للإنتاج</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDsrOCUDUevhiv2rYc5ATx4NTnBkKQ-T9k",
            authDomain: "mtmconsult-f48f1.firebaseapp.com",
            projectId: "mtmconsult-f48f1",
            storageBucket: "mtmconsult-f48f1.firebasestorage.app",
            messagingSenderId: "668149959230",
            appId: "1:668149959230:web:06c54fd158d03faf8e9f6f",
            measurementId: "G-TR97F5BZ7L"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Test Firebase connection
        document.getElementById('testFirebase').addEventListener('click', async function() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `
                <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded">
                    <p class="font-medium">🔄 جاري اختبار الاتصال مع Firebase...</p>
                    <p class="text-sm mt-1">Project: mtmconsult-f48f1</p>
                </div>
            `;

            try {
                // Test Firestore connection
                const testDoc = await addDoc(collection(db, 'connectionTest'), {
                    message: 'اختبار الاتصال من صفحة الإعداد',
                    timestamp: serverTimestamp(),
                    status: 'success'
                });

                // Test reading data
                const querySnapshot = await getDocs(collection(db, 'connectionTest'));

                resultDiv.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                        <p class="font-medium">✅ نجح الاتصال مع Firebase!</p>
                        <div class="text-sm mt-2 space-y-1">
                            <p>• تم إنشاء مستند اختبار: ${testDoc.id}</p>
                            <p>• عدد المستندات في المجموعة: ${querySnapshot.size}</p>
                            <p>• Firestore يعمل بشكل صحيح</p>
                            <p>• يمكنك الآن استخدام التطبيق مع قاعدة البيانات</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Firebase test error:', error);
                resultDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <p class="font-medium">❌ فشل الاتصال مع Firebase</p>
                        <div class="text-sm mt-2">
                            <p><strong>الخطأ:</strong> ${error.message}</p>
                            <p class="mt-2"><strong>الحلول المقترحة:</strong></p>
                            <ul class="list-disc list-inside mt-1 space-y-1">
                                <li>تأكد من تفعيل Firestore Database</li>
                                <li>تأكد من قواعد الأمان في Firestore</li>
                                <li>تحقق من إعدادات المشروع في Firebase Console</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        });

        // Add sample data
        document.getElementById('addSampleData').addEventListener('click', async function() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">
                    <p class="font-medium">📊 جاري إضافة البيانات التجريبية...</p>
                </div>
            `;

            try {
                // Add sample doctor
                const sampleDoctor = {
                    name: 'د. أحمد محمد',
                    email: 'ahmed@mtmconsult.com',
                    phone: '+966501234567',
                    specialty: 'طب القلب',
                    license: 'DOC001',
                    hospital: 'مستشفى الملك فيصل التخصصي',
                    experience: '10 سنوات',
                    bio: 'طبيب متخصص في طب القلب مع خبرة واسعة',
                    status: 'active',
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                const doctorRef = await addDoc(collection(db, 'doctors'), sampleDoctor);

                // Add sample join request
                const sampleRequest = {
                    name: 'د. فاطمة علي',
                    email: 'fatima@mtmconsult.com',
                    phone: '+966507654321',
                    specialty: 'طب الأطفال',
                    license: 'DOC002',
                    hospital: 'مستشفى الأطفال',
                    experience: '8 سنوات',
                    bio: 'طبيبة متخصصة في طب الأطفال',
                    status: 'pending',
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                const requestRef = await addDoc(collection(db, 'joinRequests'), sampleRequest);

                resultDiv.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                        <p class="font-medium">✅ تم إضافة البيانات التجريبية بنجاح!</p>
                        <div class="text-sm mt-2 space-y-1">
                            <p>• طبيب تجريبي: ${doctorRef.id}</p>
                            <p>• طلب انضمام تجريبي: ${requestRef.id}</p>
                            <p>• يمكنك الآن رؤية البيانات في لوحة تحكم المدير</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error adding sample data:', error);
                resultDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <p class="font-medium">❌ فشل في إضافة البيانات التجريبية</p>
                        <p class="text-sm mt-1"><strong>الخطأ:</strong> ${error.message}</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
